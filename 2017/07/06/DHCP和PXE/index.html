<!DOCTYPE html>













<html class="theme-next pisces" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>

<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "ca4015c6"
    });
  daovoice('update');
  </script>

  <meta name="description" content="PXE安装只是实现BIOS系统的自动化安装，对于UEFI的不支持，对于UEFI的可以使用cobblercobbler实现系统自动化安装cobbler自动化系统安装">
<meta name="keywords" content="运维，linux，windows">
<meta property="og:type" content="article">
<meta property="og:title" content="DHCP和PXE">
<meta property="og:url" content="https://www.liukui.tech/2017/07/06/DHCP和PXE/index.html">
<meta property="og:site_name" content="Coool&#39;s Blog">
<meta property="og:description" content="PXE安装只是实现BIOS系统的自动化安装，对于UEFI的不支持，对于UEFI的可以使用cobblercobbler实现系统自动化安装cobbler自动化系统安装">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-01-07T11:23:00.372Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DHCP和PXE">
<meta name="twitter:description" content="PXE安装只是实现BIOS系统的自动化安装，对于UEFI的不支持，对于UEFI的可以使用cobblercobbler实现系统自动化安装cobbler自动化系统安装">






  <link rel="canonical" href="https://www.liukui.tech/2017/07/06/DHCP和PXE/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>DHCP和PXE | Coool's Blog</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">
<link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>
  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Coool's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">As we watch our love grow.</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-address-card"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">28</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">33</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">60</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-书单&music">

    
    
    
      
    

    
      
    

    <a href="/shudan/" rel="section"><i class="menu-item-icon fa fa-fw fa-gratipay"></i> <br>书单&music</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  


</div>
    </header>

    <a href="https://github.com/liukkui" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub">
      <svg width="80" height="80" viewbox="0 0 250 250" style="fill:#222; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
    <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
      </svg>
      </a>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.liukui.tech/2017/07/06/DHCP和PXE/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="空腹吃早餐">
      <meta itemprop="description" content="C'est la vie">
      <meta itemprop="image" content="/images/haha.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coool's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">DHCP和PXE
              
            
          </h1>
        

        <div class="post-meta">
                  
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-07-06 08:00:00" itemprop="dateCreated datePublished" datetime="2017-07-06T08:00:00+08:00">2017-07-06</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/系统安装/" itemprop="url" rel="index"><span itemprop="name">系统安装</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">9.6k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">9 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>PXE安装只是实现BIOS系统的自动化安装，对于UEFI的不支持，对于UEFI的可以使用cobbler<br>cobbler实现系统自动化安装<a href="https://www.liukui.tech/2017/05/06/Cobbler/">cobbler自动化系统安装</a><br><a id="more"></a></p>
<h3 id="DHCP服务-amp-PXE自动化安装系统"><a href="#DHCP服务-amp-PXE自动化安装系统" class="headerlink" title="DHCP服务&amp;PXE自动化安装系统"></a>DHCP服务&amp;PXE自动化安装系统</h3><h3 id="DHCP服务-著名的Inter系统协会组织：研发的DHCP和DNS技术"><a href="#DHCP服务-著名的Inter系统协会组织：研发的DHCP和DNS技术" class="headerlink" title="DHCP服务:(著名的Inter系统协会组织：研发的DHCP和DNS技术)"></a>DHCP服务:(著名的Inter系统协会组织：研发的DHCP和DNS技术)</h3><p>DHCP官方文档：<a href="http://www.isc.org/downloads/DHCP/" target="_blank" rel="noopener">DHCP文档</a><br>BIND官网文档：<a href="https://www.isc.org/downloads/BIND/" target="_blank" rel="noopener">BIND文档</a><br>DNS搭建的相关文档:<a href="https://www.jianshu.com/p/50c8105fae32" target="_blank" rel="noopener">DNS原理解析&amp;搭建</a></p>
<p>PXE安装只是实现BIOS系统的自动化安装，对于UEFI的不支持，对于UEFI的可以使用cobbler<br>cobbler实现系统自动化安装<a href="">cobbler自动化系统安装</a></p>
<p>全文只有二个实验：搭建DHCP和在centos7实现基于PXE安装centos7和centos6(centos6上原理类似)</p>
<h3 id="搭建DHCP服务器：基于UDP协议-dhcp服务器端口：67、dhcp客户端端口：68"><a href="#搭建DHCP服务器：基于UDP协议-dhcp服务器端口：67、dhcp客户端端口：68" class="headerlink" title="搭建DHCP服务器：基于UDP协议(dhcp服务器端口：67、dhcp客户端端口：68)"></a>搭建DHCP服务器：基于UDP协议(dhcp服务器端口：67、dhcp客户端端口：68)</h3><pre><code>DHCP: （Dynamic Host Configuration Protocol）
    动态主机配置协议
    局域网协议，UDP协议(67端口)
主要用途：
    用于内部网络和网络服务供应商自动分配IP地址给用户
    用于内部网络管理员作为对所有电脑作集中管理的手段
使用场景
    自动化安装系统
    解决IPV4资源不足问题
</code></pre><h3 id="DHCP申请网络地址是通过四个过程实现的：四个数据报文"><a href="#DHCP申请网络地址是通过四个过程实现的：四个数据报文" class="headerlink" title="DHCP申请网络地址是通过四个过程实现的：四个数据报文"></a>DHCP申请网络地址是通过四个过程实现的：四个数据报文</h3><pre><code>DHCP共有八种报文
    1.DHCP DISCOVER：客户端到服务器
    2.DHCP OFFER ：服务器到客户端
    3.DHCP REQUEST：客户端到服务器
    4.DHCP ACK ：服务器到客户端
    DHCP NAK：服务器到客户端,通知用户无法分配合适的IP
    地址
        DHCP DECLINE ：客户端到服务器，指示地址已被使用
        DHCP RELEASE：客户端到服务器，放弃网络地址和取消
    剩余的租约时间
        DHCP INFORM：客户端到服务器, 客户端如果需要从DHCP
        服务器端获取更为详细的配置信息，则发送Inform报文向
        服务器进行请求，极少用到
    同网段多DHCP服务
        DHCP服务必须基于本地
        先到先得的原则
    跨网段
        RFC 1542 Compliant Routers
        dhcrelay: 中继
    相关协议
        Arp
        rarp
</code></pre><h3 id="DHCP服务器的实现方式：搭建DHCP服务器"><a href="#DHCP服务器的实现方式：搭建DHCP服务器" class="headerlink" title="DHCP服务器的实现方式：搭建DHCP服务器"></a>DHCP服务器的实现方式：搭建DHCP服务器</h3><pre><code>Linux DHCP协议的实现程序：dhcp, dnsmasq（dhcp,dns）
    1.实现DHCP的软件有两个：dnsmasp,这个软件是安装系统是默认的一个
        可以同时提供dns和dhcp两种服务，不是很专业
        如：ss -ntl 看到的默认就有dnsmasp服务
        LISTEN     0      5                  192.168.122.1:53  
        users:((&quot;dnsmasq&quot;,pid=1506,fd=6))
    2.DHCP更专业：下面主要介绍
</code></pre><h3 id="实验：DHCP服务的搭建"><a href="#实验：DHCP服务的搭建" class="headerlink" title="实验：DHCP服务的搭建"></a>实验：DHCP服务的搭建</h3><pre><code>实验前提：
    1.把vmware虚拟机的主机都设置成仅主机模式，要不然会影响所在的
        工作中的DHCP服务器，其他人可能会获取到实验配置的DHCP服务
        获取到一个不能上网的IP地址
    2.编辑vmware的虚拟网络编辑器，将仅主机的DHCP服务关闭，这样当前
        就只有自己配置的DHCP服务器了

Dhcp Server相关配置文件：
    /etc/dhcp/dhcpd.conf  ---&gt;主要配置文件
    /usr/lib/systemd/system/dhcpd.service  ---&gt;服务名
    /usr/sbin/dhcpd        ---&gt;dhcp的主程序
    /etc/dhcp/dhcpd.conf --&gt; /etc/rc.d/init.d/dhcpd
    /etc/dhcp/dhcpd6.conf--&gt; /etc/rc.d/init.d/dhcpd6
    /var/lib/dhcpd/dhcpd.leases   ---&gt;租出去的地址信息库文件
    /usr/sbin/dhcrelay
    /etc/rc.d/init.d/dhcrelay
    dhcp server:67/udp
    dhcp client: 68/udp
    dhcpv6 client:546/udp
Dhcp client
    dhclient
    自动获取的IP信息： /var/lib/dhclient
</code></pre><h3 id="dhcp-conf配置文件内容设置："><a href="#dhcp-conf配置文件内容设置：" class="headerlink" title="dhcp.conf配置文件内容设置："></a>dhcp.conf配置文件内容设置：</h3><pre><code>安装DHCP完,默认是启动不了的，因为配置文件dhcpd.conf是空的
1.先通过模板生成新的配置文件
    cp /usr/share/doc/dhcp*/dhcpd.conf.example /etc/dhcp/dhcpd.conf
2.模板里的网段地址不对，需要修改，网段和IP范围
    question：那么如何修改dhcd.conf配置文件？
    answer：根据上面的模板文件中的信息自改自定义的一些值
    该文件中定义了：
        1.默认续租时间和最长租期
        2.DHCP默认分配的网段和分配的IP地址范围
        3.DHCP服务提供的默认网关地址和DNS地址
3.前两项设置其他主机只是通过DHCP自动获取地址的需求，如果通过dhcp实现系统的
    自动化安装，就不仅仅获取到地址，还需要从DHCP获取能启动计算机的文件，即
    dhcp的配置文件中要有配置的地址：类似于grub的文件

    其它配置选项：
        filename: 指明引导文件名称
        next-server：提供引导文件的服务器IP地址
    示例：
        filename &quot;pxelinux.0&quot;;
        next-server 192.168.100.100; 
            网络中下载文件的主机地址，带有tftp功能
    备注：如果网卡有pxe的功能即自带tftp的功能

所以具有完整的功能的dhcp配置文件dhcp.conf内容类似；
    default-lease-time 600;
    max-lease-time 7200;
    subnet 192.168.34.0 netmask 255.255.255.0 {
        range 192.168.34.20 192.168.34.100; 
        option routers 192.168.34.1;
        option domain-name-servers 6.6.6.6;
        ext-server 192.168.34.103;
        filename &quot;pxelinux.0&quot;;  PXE安装相关的配置  
    } 
上面是主要配置内容，在dhcpd.conf中还可以把指定的mac地址与IP绑定
    host passacaglia {
        hardware ethernet 00:0c:29:af:45:f7;
        fixed-address 192.168.34.80
    }
</code></pre><h3 id="安装tftp服务-UDP协议：69端口"><a href="#安装tftp服务-UDP协议：69端口" class="headerlink" title="安装tftp服务:(UDP协议：69端口)"></a>安装tftp服务:(UDP协议：69端口)</h3><pre><code>    yum install tftp-server -y
    [root@node7-1 tftpboot]#rpm -ql tftp-server
    /etc/xinetd.d/tftp                   
    /usr/lib/systemd/system/tftp.service
    /usr/lib/systemd/system/tftp.socket
    /usr/sbin/in.tftpd
    /var/lib/tftpboot   存放下载上传的路径:系统所需要的文件
centos7和centos6上安装tftp是由区别的
    centos7上需要安装tftp-server服务--&gt;UDP69端口
        yum install tftp-server
        systemctl start tftp
    在centos6上安装和telnet是一个道理，都依赖于xinetd
        chkconfig tftp on--&gt; /etc/xinetd.d/tftp配置文件
        service restart xinted
</code></pre><h3 id="PXE介绍"><a href="#PXE介绍" class="headerlink" title="PXE介绍"></a>PXE介绍</h3><pre><code>PXE：
    Preboot Excution Environment 预启动执行环境
    Intel公司研发
    基于Client/Server的网络模式，支持远程主机通过网络从远端服务器下载
        映像，并由此支持通过网络启动操作系统
    PXE可以引导和安装Windows,linux等多种操作系统
</code></pre><h3 id="实验：在centos7实现基于PXE安装centos7和centos6"><a href="#实验：在centos7实现基于PXE安装centos7和centos6" class="headerlink" title="实验：在centos7实现基于PXE安装centos7和centos6"></a>实验：在centos7实现基于PXE安装centos7和centos6</h3><pre><code>自动化安装步骤：
1.安装前准备：关闭防火墙和SELINUX，DHCP服务器静态IP
2.安装软件包
    httpd tftp-server dhcp syslinux system-config-kickstart
    httpd:实现yum源
    tftp-server：实现网络下载的文件
    syslinux: 准备pxelinux.0文件 
        备注：centos6上是安装syslinux-nonlinux
    system-config-kickstart制作kickstart软件，建议自己制作

3.配置文件共享服务：
    准备centos7&amp;centos6的yum源
        systemctl enable httpd
        systemctl start httpd
        mkdir -pv /var/www/html/centos/{6,7}/os/x86_64
        mount /dev/sr0 /var/www/html/centos/7/os/x86_64
        mount /dev/sr1 /var/www/html/centos/6/os/x86_64
4.准备kickstart文件
    拷贝已经安装机器上的anaconda文件，按照自定义稍微修改，放到http目录下
    注意：644权限
    cp anaconda-ks.cfg /var/www/html/ksdir/ks7-min.cfg
    cp anaconda-ks.cfg /var/www/html/ksdir/ks7-min.cfg

    ks应答文件的内容可以用system-config-kickstart或者anaconda修改就行了
    最好是通过system-config-kickstart做一个应答文件，通过界面更深刻理解
        每一项代表的意义
    大概内容如下：(最后附件的有详细的ks文件内容)
        url --url=http://192.168.34.7/centos/7/os/x86_64/
        text
        firewall --disabled
        selinux --disabled
        clearpart --all --initlabel
        zerombr
        reboot
        %packages
        @core
        %end

5.配置tftp服务
    systemctl enable tftp.socket
    systemctl start tftp.socket 
6.配置DHCP服务
    cp /usr/share/doc/dhcp-4.2.5/dhcpd.conf.example /etc/dhcpd/dhcpd.conf
    vim /etc/dhcp/dhcpd.conf
        option domain-name &quot;example.com&quot;;
        default-lease-time 600;
        max-lease-time 7200;
        subnet 192.168.34.0 netmask 255.255.255.0 {
            range 192.168.34.20 192.168.34.100; 
            option routers 192.168.34.1;
            option domain-name-servers 6.6.6.6;
            next-server 192.168.34.103;
            filename &quot;pxelinux.0&quot;;   
        }
    systemctl enable dhcpd
    systemctl start dhcpd
7.准备PXE相关文件
    放pxelinux.0的专用目录，启动菜单
        mkdir /var/lib/tftpboot/pxelinux.cfg/
    分别存放6和7的vmliuz和initrd.img文件    
        mkdir linux{6,7}
    拷贝6和7安装必要文件
        cp /var/www/html/centos/6/os/x86_64/isolinux/{vmlinuz,initrd.img} 
            /var/lib/tftpboot/linux6/
        cp /var/www/html/centos/7/os/x86_64/isolinux/{vmlinuz,initrd.img} 
            /var/lib/tftpboot/linux7/
    cp /usr/share/syslinux/{pxelinux.0,menu.c32} /var/lib/tftpboot/
    将光盘里的启动菜单拷贝到并改名为default
        cp /var/www/html/centos/7/os/x86_64/isolinux.cfg /var/lib/tftpboot/
            pxelinux.cfg/default 
拷贝完所有文件,文件列表如下：
    /var/lib/tftpboot/
    .
    ├── linux6
    │   ├── initrd.img
    │   └── vmlinuz
    ├── linux7
    │   ├── initrd.img
    │   └── vmlinuz
    ├── menu.c32
    ├── pxelinux.0
    └── pxelinux.cfg
        └── default

8.准备启动菜单
菜单项可以自定义多个，如只有mini7和mini6的，还有必须要有本地硬盘启动的菜单项
    但是要在文件内把各个的linuz和initrd路径
vim /var/lib/tftpboot/pxelinux.cfg/default
default menu.c32
timeout 100
menu title PXE Install CentOS

label mini7
  menu label ^Auto Install Mini CentOS 7
  kernel linux7/vmlinuz
  append initrd=linux7/initrd.img ks=http://192.168.34.7/ksdir/ks7-mini.cfg

label mini6
  menu label ^Auto Install Mini CentOS 6
  kernel linux6/vmlinuz
  append initrd=linux6/initrd.img ks=http://192.168.34.7/ksdir/ks6-mini.cfg

label local
  menu default
  menu label Boot from ^local drive
  localboot 0xffff.

  9.准备完所有的文件和软件后，启动所有的服务，就可以测试PXE安装了。
</code></pre><h3 id="附带centos7和centos6的ks应答文件模板：建议通过ystem-config-kickstart做一个应答文件，通过界面更深刻理解每一项代表的意义，当然也可以修改anaconda-ks-cfg文件"><a href="#附带centos7和centos6的ks应答文件模板：建议通过ystem-config-kickstart做一个应答文件，通过界面更深刻理解每一项代表的意义，当然也可以修改anaconda-ks-cfg文件" class="headerlink" title="附带centos7和centos6的ks应答文件模板：建议通过ystem-config-kickstart做一个应答文件，通过界面更深刻理解每一项代表的意义，当然也可以修改anaconda-ks.cfg文件"></a>附带centos7和centos6的ks应答文件模板：建议通过ystem-config-kickstart做一个应答文件，通过界面更深刻理解每一项代表的意义，当然也可以修改anaconda-ks.cfg文件</h3><h3 id="ks6-mini-cfg"><a href="#ks6-mini-cfg" class="headerlink" title="ks6-mini.cfg"></a>ks6-mini.cfg</h3><pre><code>install
url --url=http://192.168.34.103/centos/6/os/x86_64/
    #httpd的yum源路径
lang en_US.UTF-8
keyboard us
text      #纯文本安装
reboot    #安装完重启
network --onboot yes --device eth0 --bootproto dhcp --noipv6
rootpw  --iscrypted $6$6zeqEsKimGywyY3J$ngSoHUIrLaydTMIwnYX9tg4HOeOCXogU03miaQIc8sOwmq5N6.fPk3Jrmouns8VOekZkn0YQjQkt
JjA57WrZO0
firewall --service=ssh      关闭防火墙
authconfig --enableshadow --passalgo=sha512
selinux --enforcing         关闭selinux
timezone Asia/Shanghai      时区信息
bootloader --location=mbr --driveorder=sda --append=&quot;crashkernel=auto rhgb quiet&quot; 
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
clearpart --all        清空分区信息
zerombr                清空mbr
#自定义的分区信息
part /boot --fstype=ext4 --size=1024
part / --fstype=ext4 --size=50000
part /data --fstype=ext4 --size=30000
part swap --size=2048
#自定义的分区信息

%packages
@core
%end   只安装最基本的核心包，后面也可以加上安装后脚本
</code></pre><h3 id="ks7-mini-cfg：类似centos6的只是稍微的区别"><a href="#ks7-mini-cfg：类似centos6的只是稍微的区别" class="headerlink" title="ks7-mini.cfg：类似centos6的只是稍微的区别"></a>ks7-mini.cfg：类似centos6的只是稍微的区别</h3><pre><code>auth --enableshadow --passalgo=sha512
url --url=http://192.168.34.103/centos/7/os/x86_64/
text
firstboot --enable                                                                                                  
ignoredisk --only-use=sda
keyboard --vckeymap=us --xlayouts=&apos;us&apos;
lang en_US.UTF-8

network  --bootproto=dhcp --device=ens33 --onboot=off --ipv6=auto --activate
network  --hostname=centos7.localdomain

rootpw --iscrypted $6$j2QVLmDO2xasQEW0$xEvr1jyj1mHs0HBtCc7jD73r6u4NrQCxwVoAu.SMXhwm8GiKBHq5ETZ2zFxP4rFsNavYbG0u6Gq13
Igxrn1Ry.
firewall --disabled
selinux --disabled
services --enabled=&quot;chronyd&quot;
timezone Asia/Shanghai --isUtc
user --name=test --password=$6$Awcwirg.mougtUlL$Yr1a9e2Vfs2k/Nizdn/ZeiunlsU.rJAmI1vhp1iafeccRt48h3PVIlnVwGvKPPt4dVum
a/W32jzYIsn1XCrva. --iscrypted --gecos=&quot;test&quot;
bootloader --append=&quot; crashkernel=auto&quot; --location=mbr --boot-drive=sda
clearpart --all --initlabel
zerombr
reboot

part / --fstype=&quot;xfs&quot; --ondisk=sda --size=51200
part /boot --fstype=&quot;xfs&quot; --ondisk=sda --size=1024
part swap --fstype=&quot;swap&quot; --ondisk=sda --size=4096
part /data --fstype=&quot;xfs&quot; --ondisk=sda --size=30720

%packages
@core
%end
</code></pre>
      
    </div>

    

    
    
    

<div>
  
      <div>
    
        <div style="text-align:center;color: #FF0000;font-size:16px;">-------------------码字不易<i class="fa fa-heart"></i>尊重原创<i class="fa fa-heart"></i>转载标注<i class="fa fa-heart"></i>不胜感激-------------------</div>
    
</div>
  
</div>
<div>
      
        
      
</div>
    

    
       
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Coffee or Tea？</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="空腹吃早餐 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="空腹吃早餐 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/运维，linux，windows/" rel="tag"><i class="fa fa-tag"></i> 运维，linux，windows</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
               <div>
                 
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

               </div>
            
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/05/20/MHA实现mysql高可用/" rel="next" title="MHA实现mysql高可用">
                <i class="fa fa-chevron-left"></i> MHA实现mysql高可用
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/12/mysql主从复制/" rel="prev" title="mysql主从复制">
                mysql主从复制 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/haha.gif" alt="空腹吃早餐">
            
              <p class="site-author-name" itemprop="name">空腹吃早餐</p>
              <p class="site-description motion-element" itemprop="description">C'est la vie</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">60</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">33</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">28</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:liukui_work@163.com" title="E-Mail &rarr; mailto:liukui_work@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.jianshu.com/u/a723bf5483d7" title="简书 &rarr; https://www.jianshu.com/u/a723bf5483d7" rel="noopener" target="_blank"><i class="fa fa-fw fa-heartbeat"></i>简书</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/2879352237/profile?rightmod=1&wvr=6&mod=personinfo" title="Weibo &rarr; https://weibo.com/2879352237/profile?rightmod=1&wvr=6&mod=personinfo" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://music.163.com/#/user/home?id=321895687" title="CloudMusic &rarr; https://music.163.com/#/user/home?id=321895687" rel="noopener" target="_blank"><i class="fa fa-fw fa-music"></i>CloudMusic</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://shuinoo.github.io/" title="https://shuinoo.github.io/" rel="noopener" target="_blank">蔡shuishui</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://litten.me/" title="http://litten.me/" rel="noopener" target="_blank">litten</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://jysperm.me/" title="https://jysperm.me/" rel="noopener" target="_blank">Mr wang</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ephen.me/" title="https://ephen.me/" rel="noopener" target="_blank">Ephen</a>
                  </li>
                
              </ul>
            </div>
          
          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#DHCP服务-amp-PXE自动化安装系统"><span class="nav-number">1.</span> <span class="nav-text">DHCP服务&amp;PXE自动化安装系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DHCP服务-著名的Inter系统协会组织：研发的DHCP和DNS技术"><span class="nav-number">2.</span> <span class="nav-text">DHCP服务:(著名的Inter系统协会组织：研发的DHCP和DNS技术)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#搭建DHCP服务器：基于UDP协议-dhcp服务器端口：67、dhcp客户端端口：68"><span class="nav-number">3.</span> <span class="nav-text">搭建DHCP服务器：基于UDP协议(dhcp服务器端口：67、dhcp客户端端口：68)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DHCP申请网络地址是通过四个过程实现的：四个数据报文"><span class="nav-number">4.</span> <span class="nav-text">DHCP申请网络地址是通过四个过程实现的：四个数据报文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DHCP服务器的实现方式：搭建DHCP服务器"><span class="nav-number">5.</span> <span class="nav-text">DHCP服务器的实现方式：搭建DHCP服务器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实验：DHCP服务的搭建"><span class="nav-number">6.</span> <span class="nav-text">实验：DHCP服务的搭建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dhcp-conf配置文件内容设置："><span class="nav-number">7.</span> <span class="nav-text">dhcp.conf配置文件内容设置：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装tftp服务-UDP协议：69端口"><span class="nav-number">8.</span> <span class="nav-text">安装tftp服务:(UDP协议：69端口)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PXE介绍"><span class="nav-number">9.</span> <span class="nav-text">PXE介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实验：在centos7实现基于PXE安装centos7和centos6"><span class="nav-number">10.</span> <span class="nav-text">实验：在centos7实现基于PXE安装centos7和centos6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#附带centos7和centos6的ks应答文件模板：建议通过ystem-config-kickstart做一个应答文件，通过界面更深刻理解每一项代表的意义，当然也可以修改anaconda-ks-cfg文件"><span class="nav-number">11.</span> <span class="nav-text">附带centos7和centos6的ks应答文件模板：建议通过ystem-config-kickstart做一个应答文件，通过界面更深刻理解每一项代表的意义，当然也可以修改anaconda-ks.cfg文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ks6-mini-cfg"><span class="nav-number">12.</span> <span class="nav-text">ks6-mini.cfg</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ks7-mini-cfg：类似centos6的只是稍微的区别"><span class="nav-number">13.</span> <span class="nav-text">ks7-mini.cfg：类似centos6的只是稍微的区别</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">空腹吃早餐</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">894k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">13:32</span>
  
</div>








<center>
                <font size="4" color="#FF0000">Coool's Blog已运行:<span id="run_time" style="color:#DB70DB"></span></font>
            </center>

            <script>
                function runTime() {
                    var d = new Date(), str = '';
                    BirthDay = new Date("June 01,2017");
                    today = new Date();
                    timeold = (today.getTime() - BirthDay.getTime());
                    sectimeold = timeold / 1000
                    secondsold = Math.floor(sectimeold);
                    msPerDay = 24 * 60 * 60 * 1000
                    msPerYear = 365 * 24 * 60 * 60 * 1000
                    e_daysold = timeold / msPerDay
                    e_yearsold = timeold / msPerYear
                    daysold = Math.floor(e_daysold);
                    yearsold = Math.floor(e_yearsold);
                    str = yearsold + "年";
                    str += daysold-365 + "天";
                    str += d.getHours() + '时';
                    str += d.getMinutes() + '分';
                    str += d.getSeconds() + '秒';
                    return str;
                }
                setInterval(function () { $('#run_time').html(runTime()) }, 1000);
            </script>
        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
      
  
  <script type="text/javascript" color="255,0,0" opacity="1" zindex="-1" count="230" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.6.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.6.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      
        // ref: https://github.com/ForbesLindesay/unescape-html
        var unescapeHtml = function(html) {
          return String(html)
            .replace(/&quot;/g, '"')
            .replace(/&#39;/g, '\'')
            .replace(/&#x3A;/g, ':')
            // replace all the other &#x; chars
            .replace(/&#(\d+);/g, function (m, p) { return String.fromCharCode(p); })
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&amp;/g, '&');
        };
      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                content = unescapeHtml(content);
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>