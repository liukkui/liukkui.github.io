<!DOCTYPE html>













<html class="theme-next pisces" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>

<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "ca4015c6"
    });
  daovoice('update');
  </script>

  <meta name="description" content="linux上的系统监控命令：ps、uptime、top、sar、vmstat、iostat、dstat、iotop、lsof的使用">
<meta name="keywords" content="linux基础">
<meta property="og:type" content="article">
<meta property="og:title" content="linux上系统监控命令">
<meta property="og:url" content="https://www.liukui.tech/2017/02/01/linux上系统监控命令/index.html">
<meta property="og:site_name" content="Coool&#39;s Blog">
<meta property="og:description" content="linux上的系统监控命令：ps、uptime、top、sar、vmstat、iostat、dstat、iotop、lsof的使用">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://www.liukui.tech/2017/02/01/linux上系统监控命令/linux上常用性能调优工具.png">
<meta property="og:image" content="https://www.liukui.tech/2017/02/01/linux上系统监控命令/top输出详解.png">
<meta property="og:updated_time" content="2019-04-20T15:59:28.571Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="linux上系统监控命令">
<meta name="twitter:description" content="linux上的系统监控命令：ps、uptime、top、sar、vmstat、iostat、dstat、iotop、lsof的使用">
<meta name="twitter:image" content="https://www.liukui.tech/2017/02/01/linux上系统监控命令/linux上常用性能调优工具.png">






  <link rel="canonical" href="https://www.liukui.tech/2017/02/01/linux上系统监控命令/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>linux上系统监控命令 | Coool's Blog</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">
<!-- 音频播放 -->
<script src="//lib.baomitu.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://myhkw.cn/player/js/player.js" id="myhk" key="159888076870" m="1"></script>
  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Coool's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">As we watch our love grow.</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-address-card"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">31</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">38</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">74</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-书单&music">

    
    
    
      
    

    
      
    

    <a href="/shudan/" rel="section"><i class="menu-item-icon fa fa-fw fa-gratipay"></i> <br>书单&music</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  


</div>
    </header>

    <a href="https://github.com/liukkui" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub">
      <svg width="80" height="80" viewbox="0 0 250 250" style="fill:#222; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
    <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
      </svg>
      </a>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.liukui.tech/2017/02/01/linux上系统监控命令/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="空腹吃早餐">
      <meta itemprop="description" content="C'est la vie">
      <meta itemprop="image" content="/images/haha.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Coool's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">linux上系统监控命令
              
            
          </h1>
        

        <div class="post-meta">
                  
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-02-01 00:00:00" itemprop="dateCreated datePublished" datetime="2017-02-01T00:00:00+08:00">2017-02-01</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/linux基础/" itemprop="url" rel="index"><span itemprop="name">linux基础</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/02/01/linux上系统监控命令/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2017/02/01/linux上系统监控命令/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">21k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">19 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="linux上的系统监控命令：ps、uptime、top、sar、vmstat、iostat、dstat、iotop、lsof的使用"><a href="#linux上的系统监控命令：ps、uptime、top、sar、vmstat、iostat、dstat、iotop、lsof的使用" class="headerlink" title="linux上的系统监控命令：ps、uptime、top、sar、vmstat、iostat、dstat、iotop、lsof的使用"></a>linux上的系统监控命令：ps、uptime、top、sar、vmstat、iostat、dstat、iotop、lsof的使用</h3><a id="more"></a>
<p>–linux上常用性能调优工具<br><img src="/2017/02/01/linux上系统监控命令/linux上常用性能调优工具.png" alt="linux上常用性能调优工具"></p>
<h3 id="ps命令：process-state"><a href="#ps命令：process-state" class="headerlink" title="ps命令：process state"></a>ps命令：process state</h3><pre><code>Linux中的ps命令是Process Status的缩写。ps命令用来列出系统中当前运行的那些进程。ps命令列出的是当前那些进程的快照，
就是执行ps命令的那个时刻的那些进程，如果想要动态的显示进程信息，就可以使用top命令。；
    ps report a snapshot of the current processes
        #ps可以看到当前进程的快照状态，所以ps每次看到的可能不一样
    Linux系统各进程的相关信息均保存在/proc/PID目录下的各文件中

要对进程进行监测和控制，首先必须要了解当前进程的情况，也就是需要查看当前进程，而 ps 命令就是最基本同时也是非常强
大的进程查看命令。使用该命令可以确定有哪些进程正在运行和运行的状态、进程是否结束、进程有没有僵死、哪些进程占用了过多
的资源等等。总之大部分信息都是可以通过执行该命令得到的。 

ps 为我们提供了进程的一次性的查看，它所提供的查看结果并不动态连续的；如果想对进程时间监控，应该用 top 工具; 
kill 命令用于杀死进程;

1.ps命令使用
    支持三种选项： 
        UNIX选项 如-A -e;类似 ls -l
        BSD选项 如a 
        GNU选项 如--help 类似 ls --all
    BSD类型的选项：默认显示当前终端中的进程
        a 选项包括所有终端中的进程 
        x 选项包括不链接终端的进程 
        u 选项显示进程所有者的信息 
        f 选项显示进程树,相当于 --forest 
        k|--sort 属性对属性排序,属性前加-表示倒序
        o 属性… 选项显示定制的信息 pid、cmd、%cpu、%mem
        L 显示支持的属性列表
    UNIX类型的选项：
        -C cmdlist 指定命令，多个命令用，分隔 
        -L 显示线程 
        -e: 显示所有进程，相当于-A
        -f: 显示完整格式程序信息 
        -F: 显示更完整格式的进程信息 
        -H: 以进程层级格式显示进程相关信息 
        -u userlist 指定有效的用户ID或名称 
        -U userlist 指定真正的用户ID或名称 
        -g gid或groupname 指定有效的gid或组名称 
        -G gid或groupname 指定真正的gid或组名称 
        -p pid 显示指pid的进程 
        --ppid pid 显示属于pid的子进程 
        -M  显示SELinux信息，相当于Z
2.linux上进程有5种状态: 
    1. 运行(正在运行或在运行队列中等待) 
    2. 中断(休眠中, 受阻, 在等待某个条件的形成或接受到信号) 
    3. 不可中断(收到信号不唤醒和不可运行, 进程必须等待直到有中断发生) 
    4. 僵死(进程已终止, 但进程描述符存在, 直到父进程调用wait4()系统调用后释放) 
    5. 停止(进程收到SIGSTOP, SIGSTP, SIGTIN, SIGTOU信号后停止运行运行) 
3.ps工具标识进程的5种状态码: 
    D 不可中断 uninterruptible sleep (usually IO) 
    R 运行 runnable (on run queue) 
    S 中断 sleeping 
    T 停止 traced or stopped 
    Z 僵死 a defunct (”zombie”) process 
4.ps aux 和ps -ef的使用
    前面说过这是两种输出风格，输出项都是差不多的
    ps aux 是用BSD的格式来显示、其格式如下：
    [root@node1 ~]# ps aux 
    USER   PID %CPU %MEM    VSZ   RSS TTY  STAT START   TIME COMMAND
    root   2   0.0  0.0      0     0   ?   S    11:58   0:00 [kthreadd]
    root   3   0.0  0.0      0     0   ?   S    11:58   0:00 [ksoftirqd/0]
    同ps -ef 不同的有列有 
        USER        #用户名 
        %CPU        #进程占用的CPU百分比 
        %MEM        #占用内存的百分比 
        VSZ         #该进程使用的虚拟內存量（KB） 
            Virtual memory SiZe,虚拟内存集,进程占用的虚拟内存空间、线性内存
        RSS         #该进程占用的固定內存量（KB）（驻留中页的数量）
            ReSident Size, 常驻内存集、物理内存集,进程占用实际物理内存空间
        STAT        #进程的状态 
        START       #该进程被触发启动时间 
        TIME        #该进程实际使用CPU运行的时间,越小代表没占用资源
    其中STAT状态位常见的状态字符有 
        D: uninterruptable sleeping #无法中断的休眠状态（通常 IO 的进程）； 
        R：running                  #正在运行可中在队列中可过行的； 
        S: interruptable sleeping   #处于休眠状态； 
        T: stopped                  #停止或被追踪； 
        W                           #进入内存交换 （从内核2.6开始无效）； 
        X                           #死掉的进程 （基本很少见）； 
        Z: zombie                   #僵尸进程； 
        &lt;: 高优先级进程              #优先级高的进程 
        N：低优先级进程              #优先级较低的进程 
        L：内存分页并带锁            #有些页被锁进内存； 
        s: session leader，会话(子进程)发起者 
            #进程的领导者(在它之下有子进程)； 
        l: 多线程进程 
                #多线程，克隆线程（使用 CLONE_THREAD, 类似 NPTL pthreads）； 
        +: 前台进程         #位于后台的进程组；

    ps -ef 是用标准的格式显示进程的:
    [root@node1 ~]# ps -ef
    UID         PID   PPID  C  STIME   TTY      TIME CMD
    root          2      0  0  11:58   ?        00:00:00 [kthreadd]
    root          3      2  0  11:58   ?        00:00:00 [ksoftirqd/0]
    其中各列的内容意思如下 
        UID     #用户ID、但输出的是用户名 
        PID     #进程的ID 
        PPID    #父进程ID 
        C       #进程占用CPU的百分比 
        STIME   #进程启动到现在的时间 
        TTY     #该进程在那个终端上运行，若与终端无关，则显示? 若为pts/0等则表示由网络连接主机进程。 
        CMD     #命令的名称和参数
</code></pre><h3 id="iftop"><a href="#iftop" class="headerlink" title="iftop"></a>iftop</h3><pre><code>iftop监控网络中哪个进程使用流量最大,它可以实时监控哪个进程对网络接口当中带宽占用率最大；
iftop是一款实时流量监控工具,监控TCP/IP连接等,缺点就是无报表功能。必须以root身份才
能运行。
Linux下使用iftop工具结合iptables服务来解决带宽资源被恶意请求满的问题，主要通过2个步骤来实现;
监控eth1
    iftop -i eth1
基于实例讲解输出含义
执行iftop -N -n -i eth1后界面为
             19.1Mb   38.1Mb   57.2Mb  76.3Mb   95.4Mb
+-----------------+-----------------+--------------------+---------
192.168.1.11                   =&gt; 192.168.1.66       5.3Mb  3.22Mb  3.20Mb
                               &lt;=                    219kb  45.7kb  49.3kb
192.168.1.11                   =&gt; 192.168.1.29       144kb  30.8kb  29.6kb
                               &lt;=                    11.3Mb  2.38Mb  2.74Mb
192.168.1.11                   =&gt; 12.2.11.71         0b   6.40kb  6.66kb
                               &lt;=                    0b      0b      0b
192.168.1.11                   =&gt; 192.168.1.8        2.63kb  1.43kb   932b
                               &lt;=                    1.31kb  1.05kb   893b
192.168.1.11                   =&gt; 192.168.2.78       2.53kb  1.54kb  2.15kb
                               &lt;=                    160b    160b    187b
192.168.1.11                   =&gt; 111.126.195.69     0b    166b     69b
                               &lt;=                    0b      0b      0b
---------------------------------------------------------------------------
TX:      cum:   9.70MB   peak:   15.6Mb     rates:   15.4Mb  3.26Mb  3.23Mb
RX:             8.38MB           14.9Mb              11.5Mb  2.42Mb  2.79Mb
TOTAL:          18.1MB           30.5Mb              27.0Mb  5.69Mb  6.03Mb

iftop界面含义如下
    第一行：带宽显示
中间部分：外部连接列表，即记录了哪些ip正在和本机的网络连接
中间部分右边：实时参数分别是该访问ip连接到本机2秒，10秒和40秒的平均流量
=&gt;代表发送数据，&lt;= 代表接收数据
底部三行：表示发送，接收和全部的流量
底部三行第二列：为你运行iftop到目前流量
底部三行第三列：为高峰值
底部三行第四列：为平均值
通过iftop的界面很容易找到哪个ip在霸占网络流量，这个是ifstat做不到的。不过iftop的流量显示单位是Mb,这个b是bit，是位，不是字节，而ifstat的KB，这个B就是字节了，byte是bit的8倍。初学者容易被误导。

进入iftop的命令
    进入iftop画面后的一些操作命令(注意大小写)
    按h切换是否显示帮助;
    按n切换显示本机的IP或主机名;
    按s切换是否显示本机的host信息;
    按d切换是否显示远端目标主机的host信息;
    按t切换显示格式为2行/1行/只显示发送流量/只显示接收流量;
    按N切换显示端口号或端口服务名称;
    按S切换是否显示本机的端口信息;
    按D切换是否显示远端目标主机的端口信息;
    按p切换是否显示端口信息;
    按P切换暂停/继续显示;
    按b切换是否显示平均流量图形条;
    按B切换计算2秒或10秒或40秒内的平均流量;
    按T切换是否显示每个连接的总流量;
    按l打开屏幕过滤功能，输入要过滤的字符，比如ip,按回车后，屏幕就只显示这个IP相关的流量信息;
    按L切换显示画面上边的刻度;刻度不同，流量图形条会有变化;
    按j或按k可以向上或向下滚动屏幕显示的连接记录;
    按1或2或3可以根据右侧显示的三列流量数据进行排序;
    按&lt;根据左边的本机名或IP排序;
    按&gt;根据远端目标主机的主机名或IP排序;
    按o切换是否固定只显示当前的连接;
    按f可以编辑过滤代码，这是翻译过来的说法，我还没用过这个！
    按!可以使用shell命令，这个没用过！没搞明白啥命令在这好用呢！
    按q退出监控。
</code></pre><h3 id="uptime命令"><a href="#uptime命令" class="headerlink" title="uptime命令"></a>uptime命令</h3><pre><code>[root@node02 ~]# uptime
11:19:15 up 20 min,  1 user,  load average: 0.00, 0.01, 0.05

输出的项分别表示：
    11:19:15   #显示当前时间
    up 20 min  #系统已启动的时间
    1 user     #当前系统登录的上线人数
    load average: 0.00, 0.01, 0.05是指
    #系统平均负载（1、5、10 分钟的平均负载，一般不会超过1）
注意：
    1.系统平均负载: 是指在特定时间间隔内运行队列中的平均进程数 
    2.通常每个CPU内核的当前活动进程数不大于3，那么系统的性能良好。如果每 个CPU内核的任务数大于5，那么此主机的性能有严重问题 
        注意：上面是指单核cpu，如果是双核的应该不大于6，以此类推
    3.如果linux主机是1个双核CPU，当Load Average 为6的时候说明机器已经被充分使用
</code></pre><h3 id="进程管理工具–-gt-top命令"><a href="#进程管理工具–-gt-top命令" class="headerlink" title="进程管理工具–&gt;top命令"></a>进程管理工具–&gt;top命令</h3><p>–top输出详解<br><img src="/2017/02/01/linux上系统监控命令/top输出详解.png" alt="top输出详解"></p>
<pre><code>[root@node02 ~]# top
top - 11:33:09 up 34 min,  1 user,  load average: 0.10, 0.11, 0.08
Tasks:  98 total,   1 running,  97 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem :   481876 total,    23980 free,   232296 used,   225600 buff/cache
KiB Swap:  2097148 total,  2096628 free,      520 used.   185472 avail Mem 
   PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND
   6542 root      20   0  161984   2216   1560 R  0.7  0.5   0:00.02 top                                                                   
   288 root      20   0       0      0      0 S  0.3  0.0   0:00.63 xfsaild/sda2 


top：有许多内置命令 
    排序： 通过下面这些字母进行切换可以看到不同的显示信息
        P：以占据的CPU百分比,%CPU 
        M：占据内存百分比,%MEM 
        T：累积占据CPU时长,TIME+ 
    首部信息显示： 
        uptime信息：l命令 
        tasks及cpu信息：t命令 
        cpu分别显示：1 (数字) 
        memory信息：m命令 
    退出命令：q 
        修改刷新时间间隔：s 
        终止指定进程：k 
        保存文件：W  
栏位信息简介 
    us：用户空间 
    sy：内核空间 
    ni：调整nice时间 
    id：空闲 
    wa：等待IO时间 
    hi：硬中断 
    si：软中断（模式切换） 
    st：虚拟机偷走的时间
选项： 
    -d # 指定刷新时间间隔，默认为3秒 
    -b 全部显示所有进程 
    -n # 刷新多少次后退出 
    -H 线程模式，示例：top -H -p `pidof mysqld` 

Linux top命令的用法详细详解
首先介绍top中一些字段的含义：

top 命令实时显示进程的状态。默认状态显示的是cpu密集型的进程，并且每5秒钟更新一次。你可以通过PID的数字大小，
age (newest first), time (cumulative time),resident memory usage（常驻内存使用）以及进程从启动后占用cpu的时间。 

VIRT：virtual memory usage 虚拟内存
1、进程“需要的”虚拟内存大小，包括进程使用的库、代码、数据等
2、假如进程申请100m的内存，但实际只使用了10m，那么它会增长100m，而不是实际的使用量

RES：resident memory usage 常驻内存
1、进程当前使用的内存大小，但不包括swap out
2、包含其他进程的共享
3、如果申请100m的内存，实际使用10m，它只增长10m，与VIRT相反
4、关于库占用内存的情况，它只统计加载的库文件所占内存大小

SHR：shared memory 共享内存
1、除了自身进程的共享内存，也包括其他进程的共享内存
2、虽然进程只使用了几个共享库的函数，但它包含了整个共享库的大小
3、计算某个进程所占的物理内存大小公式：RES – SHR
4、swap out后，它将会降下来

DATA
1、数据占用的内存。如果top没有显示，按f键可以显示出来。
2、真正的该程序要求的数据空间，是真正在运行中要使用的。

top 运行中可以通过 top 的内部命令对进程的显示方式进行控制。内部命令如下：
s – 改变画面更新频率
l – 关闭或开启第一部分第一行 top 信息的表示
t – 关闭或开启第一部分第二行 Tasks 和第三行 Cpus 信息的表示
m – 关闭或开启第一部分第四行 Mem 和 第五行 Swap 信息的表示
N – 以 PID 的大小的顺序排列表示进程列表
P – 以 CPU 占用率大小的顺序排列进程列表
M – 以内存占用率大小的顺序排列进程列表
h – 显示帮助
n – 设置在进程列表所显示进程的数量
q – 退出 top
s – 改变画面更新周期

序号 列名 含义
a PID 进程id
b PPID 父进程id
c RUSER Real user name
d UID 进程所有者的用户id
e USER 进程所有者的用户名
f GROUP 进程所有者的组名
g TTY 启动进程的终端名。不是从终端启动的进程则显示为 ?
h PR 优先级
i NI nice值。负值表示高优先级，正值表示低优先级
j P 最后使用的CPU，仅在多CPU环境下有意义
k %CPU 上次更新到现在的CPU时间占用百分比
l TIME 进程使用的CPU时间总计，单位秒
m TIME+ 进程使用的CPU时间总计，单位1/100秒
n %MEM 进程使用的物理内存百分比
o VIRT 进程使用的虚拟内存总量，单位kb。VIRT=SWAP+RES
p SWAP 进程使用的虚拟内存中，被换出的大小，单位kb。
q RES 进程使用的、未被换出的物理内存大小，单位kb。RES=CODE+DATA
r CODE 可执行代码占用的物理内存大小，单位kb
s DATA 可执行代码以外的部分(数据段+栈)占用的物理内存大小，单位kb
t SHR 共享内存大小，单位kb
u nFLT 页面错误次数
v nDRT 最后一次写入到现在，被修改过的页面数。
w S 进程状态。（D=不可中断的睡眠状态，R=运行，S=睡眠，T=跟踪/停止，Z=僵尸进程）
x COMMAND 命令名/命令行
y WCHAN 若该进程在睡眠，则显示睡眠中的系统函数名
z Flags 任务标志，参考 sched.h

默认情况下仅显示比较重要的 PID、USER、PR、NI、VIRT、RES、SHR、S、%CPU、%MEM、TIME+、COMMAND 列。可以通过下面的快捷
键来更改显示内容。

通过 f 键可以选择显示的内容。按 f 键之后会显示列的列表，按 a-z 即可显示或隐藏对应的列，最后按回车键确定。
按 o 键可以改变列的显示顺序。按小写的 a-z 可以将相应的列向右移动，而大写的 A-Z 可以将相应的列向左移动。最后按回车键确定。
按大写的 F 或 O 键，然后按 a-z 可以将进程按照相应的列进行排序。而大写的 R 键可以将当前的排序倒转。
</code></pre><h3 id="sar"><a href="#sar" class="headerlink" title="sar"></a>sar</h3><pre><code>sar（System ActivityReporter系统活动情况报告）是目前Linux上最为全面的系统性能分析工具之一，可以从多方面对系统
的活动进行报告，包括：文件的读写情况、系统调用的使用情况、磁盘I/O、CPU效率、内存使用状况、进程活动及IPC有关的活动
等，sar命令有sysstat安装包安装，本文主要以CentOS 6系列x64系统为例，介绍sar命令。

1.sar输出
    [root@node02 ~]# sar
    Linux 3.10.0-862.el7.x86_64 (node02)    04/20/2019  _x86_64_    (1 CPU)
    12:10:01 PM  CPU   %user   %nice   %system  %iowait   %steal    %idle
    12:20:01 PM  all   1.48    0.00    0.82      0.08      0.00     97.61
    12:30:01 PM  all   2.39    0.00    0.94      0.01      0.00     96.65
    12:40:02 PM  all   2.10    0.00    1.24      0.05      0.00     96.61
    12:50:01 PM  all   0.27    0.00    0.39      0.01      0.00     99.33
    Average:     all   1.56    0.00    0.85      0.04      0.00     97.55
</code></pre><h3 id="内存管理工具之–-gt-vmstat-虚拟内存信息"><a href="#内存管理工具之–-gt-vmstat-虚拟内存信息" class="headerlink" title="内存管理工具之–&gt;vmstat:虚拟内存信息"></a>内存管理工具之–&gt;vmstat:虚拟内存信息</h3><pre><code>1.用来获得有关进程、虚存、页面交换空间及CPU活动的信息。这些信息反映了系统的负载情况;
2.虚拟内存运行原理：
    在系统中运行的每个进程都需要使用到内存，但不是每个进程都需要每时每刻使用系统分配的内存空间。当系统运行所需内存
    超过实际的物理内存，内核会释放某些进程所占用但未使用的部分或所有物理内存，将这部分资料存储在磁盘上直到进程下
    一次调用，并将释放出的内存提供给有需要的进程使用。

    在Linux内存管理中，主要是通过“调页Paging”和“交换Swapping”来完成上述的内存调度。调页算法是将内存中最近不常使
    用的页面换到磁盘上，把活动页面保留在内存中供进程使用。交换技术是将整个进程，而不是部分页面，全部交换到磁盘上。

    分页(Page)写入磁盘的过程被称作Page-Out，分页(Page)从磁盘重新回到内存的过程被称作Page-In。当内核需要一个分页
    时，但发现此分页不在物理内存中(因为已经被Page-Out了)，此时就发生了分页错误（Page Fault）。

    当系统内核发现可运行内存变少时，就会通过Page-Out来释放一部分物理内存。经管Page-Out不是经常发生，但是如果
    Page-out频繁不断的发生，直到当内核管理分页的时间超过运行程式的时间时，系统效能会急剧下降。这时的系统已经运行
    非常慢或进入暂停状态，这种状态亦被称作thrashing(颠簸)。
3.vmstat输出信息
    [root@node02 ~]# vmstat
    procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
    r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
    3  0    776  12968    168 230708    0    0   111     7  157  286  1  1 99  0  0
    具体代理的意义：
    procs: 
        r：可运行（正运行或等待运行）进程的个数，和核心数有关 b：处于不可中断睡眠态的进程个数(被阻塞的队列的长度) 
    memory： 
        swpd: 交换内存的使用总量 
        free：空闲物理内存总量 
        buffer：用于buffer的内存总量 
        cache：用于cache的内存总量 
    swap: 
        si：从磁盘交换进内存的数据速率(kb/s) 
        so：从内存交换至磁盘的数据速率(kb/s)
    io：
        bi：从块设备读入数据到系统的速率(kb/s) 
        bo: 保存数据至块设备的速率 
    system： 
        in: interrupts  中断速率，包括时钟 
        cs: context switch  进程切换速率 
    cpu： 
        us:Time spent running non-kernel code 
        sy: Time spent running kernel code 
        id: Time spent idle. Linux 2.5.41前,包括IO-wait time. 
        wa: Time spent waiting for IO.  2.5.41前，包括in idle. 
        st: Time stolen from a virtual machine.  2.6.11前, unknown
    选项： 
        -s: 显示内存的统计数据
</code></pre><h3 id="内存管理工具之–-gt-iostat-统计CPU和设备IO信息"><a href="#内存管理工具之–-gt-iostat-统计CPU和设备IO信息" class="headerlink" title="内存管理工具之–&gt;iostat:统计CPU和设备IO信息"></a>内存管理工具之–&gt;iostat:统计CPU和设备IO信息</h3><pre><code>1.iostat是用来专门统计CPU和设备IO信息
2.iostat输出详情：
    [root@node02 ~]# iostat
    Linux 3.10.0-862.el7.x86_64 (node02)    04/20/2019  _x86_64_    (1 CPU)
    avg-cpu:  %user   %nice %system %iowait  %steal   %idle
               9.22    0.00   11.37    1.70    0.00   77.71
    Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
    sda              94.95      3944.03       690.62     443506      77660
    sdb               0.78        18.50         0.00       2080          0
    sdc               0.78        18.50         0.00       2080          0
    sdd               0.78        18.50         0.00       2080          0
    scd0              0.16         9.14         0.00       1028          0
    输出信息解释：
    avg-cpu:  %user   %nice %system %iowait  %steal   %idle
        #是指平均cpu利用率
    Device:     #每块磁盘的具体情况
    tps         #当前磁盘每秒钟处理事务的速度
    kB_read/s   #当前磁盘每秒钟读的字节数
    kB_wrtn/s   #当前磁盘每秒钟写的字节数
    kB_read     #当前磁盘读的总量
    kB_wrtn     #当前磁盘写的总量
3.使用：
    在生产环境中可以通过这个信息观察每块磁盘的写入和读取速度进行监控
</code></pre><h3 id="系统监控工具–-gt-dstat命令：系统资源统计-代替vmstat-iostat-ifstat"><a href="#系统监控工具–-gt-dstat命令：系统资源统计-代替vmstat-iostat-ifstat" class="headerlink" title="系统监控工具–&gt;dstat命令：系统资源统计,代替vmstat,iostat,ifstat"></a>系统监控工具–&gt;dstat命令：系统资源统计,代替vmstat,iostat,ifstat</h3><pre><code>1.dstat命令是监控系统资源统计,代替vmstat(虚拟内存),iostat(磁盘读写),ifstat(网卡监控)
2.安装dstat
    [root@node02 ~]# yum install dstat -y
        #dstat命令来自dstat-0.7.2-12.el7.noarch包
3.dstat输出
    [root@node02 ~]# dstat
    You did not select any stats, using -cdngy by default.
    ----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--
    usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw 
      2   2  95   0   0   0| 814k  122k|   0     0 |1714B 2301B| 215   555 
      0   0 100   0   0   0|   0     0 |  60B  890B|   0     0 | 142   230 
      1   1  98   0   0   0|   0     0 |  60B  346B|   0     0 | 150   227 
      0   1  98   0   0   1|   0     0 |  60B  346B|   0     0 | 168   251 
      0   1  99   0   0   0|   0     0 |  60B  346B|   0     0 | 149   232 
    输出信息：
    total-cpu-usage  #cpu信息
    dsk/total        #磁盘信息
    net/total        #网卡信息
    paging：         #swap信息  
    system           #进程信息
4.dstat相关选项
    dstat [-afv] [options..] [delay [count]] 
        -c 显示cpu相关信息 
        -C #,#,...,total 
        -d 显示disk相关信息 
        -D total,sda,sdb,... 
        -g 显示page相关统计数据 
        -m 显示memory相关统计数据 
        -n 显示network相关统计数据 
        -p 显示process相关统计数据 
        -r 显示io请求相关的统计数据 
        -s 显示swapped相关的统计数据
</code></pre><h3 id="监视磁盘I-O工具–-gt-iotop"><a href="#监视磁盘I-O工具–-gt-iotop" class="headerlink" title="监视磁盘I/O工具–&gt;iotop"></a>监视磁盘I/O工具–&gt;iotop</h3><pre><code>iostat是I/O statistics（输入/输出统计）的缩写，iostat工具将对系统的磁盘操作活动进行监视。它的特点是汇报磁盘活动
统计情况，同时也会汇报出CPU使用情况。iostat也有一个弱点，就是它不能对某个进程进行深入分析，仅对系统的整体情况进行分析;

iotop命令是一个用来监视磁盘I/O使用状况的top类工具iotop具有与top相似的UI，其中包括
PID、用户、I/O、进程等相关信息，可查看每个进程是如何使用IO;

1.iotop输出信息
    [root@node02 ~]# iotop
    Total DISK READ :   0.00 B/s | Total DISK WRITE :       0.00 B/s
    Actual DISK READ:   0.00 B/s | Actual DISK WRITE:       0.00 B/s
        TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN  IO&gt; COMMAND                                                                   
    1 be/4 root        0.00 B/s    0.00 B/s  0.00 %  0.00 % systemd --switched-root --system --deserialize 22
    2 be/4 root        0.00 B/s    0.00 B/s  0.00 %  0.00 % [kthreadd]
    3 be/4 root        0.00 B/s    0.00 B/s  0.00 %  0.00 % [ksoftirqd/0
    输出信息：
    第一行：
        Total DISK READ：Read速率总计
        Total DISK WRITE：Write速率总计
    第二行：
        Actual DISK READ：实际的Read速率 
        Actual DISK WRITE：实际的Write速率 
    第三行：参数如下： 
        TID：线程ID（按p切换为进程ID） 
        PRIO：优先级 
        USER：用户 
        DISK磁盘读速率 
        READ 磁盘写速率 
        SWAPIN：swap交换百分比 
        IO&gt;：IO等待所占的百分比 
        COMMAND：线程/进程命令，这通过查看IO速率看到的是哪个进程/线程的问题
    面试常问：
        它可以查哪个进程的IO是最频繁的以及它的IO速率怎么样(精确到进程)，最后
        一项就是具体的某个进程COMMAND；
    监控：
        在zabbix监控磁盘读取和写入的速率可以判断web服务器是否受到攻击；
        主要就是将Total DISK READ和Total DISK WRITE过滤出来进行监控
2.命令格式：
    iotop  -[选项]
      --version：//显示程序的版本号并退出
      -h, --help：//显示此帮助消息并退出
      -o, --only：//仅显示实际执行I / O的进程或线程，只显示在划硬盘的程序
      -b, --batch：//非交互模式，批量处理 用来记录日志的
      -n NUM, --iter=NUM：//设定循环几次
      -d SEC, --delay=SEC：//设定显示时间间隔[秒]
      -p PID, --pid=PID：//要监控的进程/线程[全部]
      -u USER, --user=USER：//用户监控[全部]
      -P, --processes：//只显示进程，而不是所有线程
      -a, --accumulated：//显示累积的I / O而不是带宽
      -k, --kilobytes：//使用千字节而不是人性化的单位
      -t, --time：//在每一行上添加一个时间戳（暗示--batch）
      -q, --quiet：//抑制一些标题行（暗示--batch）
3.怎么获取该程序正在读的什么文件？
    这个问题其实很简单，通过 lsof 命令我们就可以达到目的：lsof -c APPname
    同样，如果我们知道了被频繁读取的文件是哪个，也可以反查程序：
    iotop查看用户进程，lsof -p pid在按该用户进程 pid 查看所打开的文件，lsof -u username按用户名查看打开的文件，
    列出某用户的某进程打开的文件lsof -u USERNAME -c APPNAME；
    也是可以根据目录进行查询：lsof | grep path；
4.结论：
    1.我们给服务器做压力测试时，有的时候很容易碰到磁盘IO读取瓶颈，持续高的IO会导致磁盘读取密集读写磁盘IO成为短
    板，程序运行过慢；常见的IO服务器例如：数据库服务器，文件服务器，视频服务器等；
    2.使用top命令查看%wa指标，该项阈值表示io waiting等待磁盘磁盘写入完成的时间，一般不能高于30%，假如该值过大
    且持续很久，就证明遇到了I/O瓶颈，需要对软件进行优化，或对硬件进行升级；
    3.iostat -d -x 1输出磁盘相关统计信息；
    4.iotop定位负载来源于那个进程/线程
    5.可以使用pt-ioprofile工具定位IO文件信息；（是Percona公司开发用于管理MySQL的工具）
 或者使用下列命令进行IO文件定位：
    1.lsof -c oracle  //
    2.lsof | grep path  /oracle/app/oracle.........................
    3.iotop   //查看用户进程
    4.lsof -p pid  //查看该用户下打开的文件
    5.lsof -u oracle   -c oracle
5.补充：如何进行IO瓶颈测试？
    如何进行大文件IO测试：
    1.生成 5g 大小的文件并输出时间，执行速度等信息
    time dd if=/dev/zero of=test.file bs=1G count=5
    2.测试写入20G数据，数据量越大，测试值应该更精确
    sync;/usr/bin/time -p bash -c &quot;(dd if=/dev/zero of=test.dd  bs=1M count=20000)&quot; 
    sync;/usr/bin/time -p bash -c &quot;(dd if=/dev/zero of=test.dd  bs=1000K count=20000;sync)&quot;
    dd bs=1M count=20000 if=/dev/zero of=test.dd conv=fdatasync dd命令测试是IO的顺序写和读方式
</code></pre><h3 id="lsof-list-open-files"><a href="#lsof-list-open-files" class="headerlink" title="lsof:list open files"></a>lsof:list open files</h3><pre><code>Lsof是遵从Unix哲学的典范，它只完成一个功能，并且做的相当完美——它可以列出某个进程打开的所有文件信息。打开的文件可
能是普通的文件、目录、NFS文件、块文件、字符文件、共享库、常规管道、命名管道、符号链接、Socket流、网络Socket、UNIX域S
ocket，以及其它更多类型。因为“一切皆文件”乃为Unix系统的重要哲学思想之一，因此可以想象lsof命令的重要地位;

list open files查看当前系统文件的工具。在linux环境下，一切皆文件， 用户通过文件不仅可以访问常规数据，还可以访问
网络连接和硬件如传输控制 协议 (TCP) 和用户数据报协议 (UDP)套接字等，系统在后台都为该应用程序分配了一个文件描述符;

lsof ［options］ filename
    lsof  /path/to/somefile：显示打开指定文件的所有进程之列表
    lsof -c string：
        显示其COMMAND列中包含指定字符(string)的进程所有打开的文件；此选项可以重复
        使用，以指定多个模式；
    lsof -p PID：
        查看该进程打开了哪些文件；进程号前可以使用脱字符“^”取反；
    lsof -u USERNAME：
        显示指定用户的进程打开的文件；用户名前可以使用脱字符“^”取反，如“lsof -u ^root”则用于显示非root用户打开的所有文件；
    lsof -g GID：
        显示归属gid的进程情况
    lsof +d /DIR/：
        显示指定目录下被进程打开的文件
    lsof +D /DIR/
        #基本功能同上，但lsof会对指定目录进行递归查找，注意这个参数要比grep版本慢：
    lsof -a：
        #按“与”组合多个条件，如lsof -a -c apache -u apache
    lsof -N：
        #列出所有NFS（网络文件系统）文件
    lsof -d FD：
        #显示指定文件描述符的相关进程；也可以为描述符指定一个范围，如0-2表示0,1,2三个文件描述符；另外，-d还支持其它很多特殊值，如：
            mem: 列出所有内存映射文件；
            mmap：显示所有内存映射设备；
            txt：列出所有加载在内存中并正在执行的进程，包含code和data；
            cwd：正在访问当前目录的进程列表；
    lsof -n：
        #不反解IP至HOSTNAME
    lsof -i：
        #用以显示符合条件的进程情况
    lsof -i[46] [protocol][@hostname|hostaddr][:service|port]
        46：IPv4或IPv6
        protocol：TCP or UDP
        hostname：Internet host name
        hostaddr：IPv4地址
        service：/etc/service中的服务名称(可以不只一个)
        port：端口号 (可以不只一个)
示例：
    1.指定进程号，可以查看该进程打开的文件 
        [root@tomcat ~]# ps -ef | grep java
        root       6657      1  9 12:36 pts/0
        [root@tomcat ~]# lsof -p 6657  #可以看到java进程打开的文件
        COMMAND  PID USER FD   TYPE    DEVICE  SIZE/OFF      NODE NAME
        java    6657 root cwd   DIR    8,2      4096        100663361 /root
        [root@tomcat ~]# lsof -p 6657 | wc -l  #统计打开的文件描述符总数

    2.查看8080端口现在运行的情况
        [root@node02 ~]# lsof -i:8080
        COMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
        java    6657 root   59u  IPv6  45756      0t0  TCP *:webcache (LISTEN)
        #类似于于ss -tnpl|grep 8080命令
        [root@node02 ~]# ss -tnpl|grep 8080
        LISTEN   0  100   :::8080   :::*  users:((&quot;java&quot;,pid=6657,fd=59))
    3.查看指定进程打开的网络连接 
        lsof -i –n -a -p 9527 参数-i、-a、-p等，-i查看网络连接情况，-a查看存在的进程，-p指定进程
    4.恢复删除正在使用的文件：
        ~]# lsof |grep /var/log/messages  #打开这个文件，模拟正在使用的情况
        ~]# rm -f /var/log/messages       #误删除操作
        ~]# lsof |grep /var/log/messages  #再次查看，就会看到delete的信息
        ~]# cat /proc/653/fd/6            
            #进入到这个文件描述符目录，可以看到文件是红色的表示删除了
        ~]# cat /proc/653/fd/6 &gt; /var/log/messages
            #将文件重定向即可达到恢复的目的
        注意：
            1.这里说的是误删除了正在使用的文件，如果某个文件未被使用删除了那就不能恢复了；
            2.在清除mysql日志的时候如果误删除了就可以使用这种方法；
lsof输出信息解释：
    上述命令中，每行显示一个打开的文件，若不指定条件默认将显示所有进程打开的所有文件。lsof输出各列信息的意义如下：
    COMMAND：进程的名称
    PID：进程标识符
    USER：进程所有者
    FD：文件描述符，应用程序通过文件描述符识别该文件。如cwd、txt等
    TYPE：文件类型，如DIR、REG等
    DEVICE：指定磁盘的名称
    SIZE：文件的大小
    NODE：索引节点（文件在磁盘上的标识）
    NAME：打开文件的确切名称
</code></pre>
      
    </div>

    

    
    
    

<div>
  
      <div>
    
        <div style="text-align:center;color: #FF0000;font-size:16px;">-------------------码字不易<i class="fa fa-heart"></i>尊重原创<i class="fa fa-heart"></i>转载标注<i class="fa fa-heart"></i>不胜感激-------------------</div>
    
</div>
  
</div>
<div>
      
        
      
</div>
    

    
       
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Coffee or Tea？</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="空腹吃早餐 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="空腹吃早餐 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/linux基础/" rel="tag"><i class="fa fa-tag"></i> linux基础</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
               <div>
                 
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

               </div>
            
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/02/01/linux网络管理命令/" rel="next" title="linux网络管理命令">
                <i class="fa fa-chevron-left"></i> linux网络管理命令
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/02/01/linux防火墙实现原理/" rel="prev" title="linux防火墙实现原理">
                linux防火墙实现原理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">
      
      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/haha.gif" alt="空腹吃早餐">
            
              <p class="site-author-name" itemprop="name">空腹吃早餐</p>
              <p class="site-description motion-element" itemprop="description">C'est la vie</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">74</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">38</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">31</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:liukui_work@163.com" title="E-Mail &rarr; mailto:liukui_work@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://www.jianshu.com/u/a723bf5483d7" title="简书 &rarr; https://www.jianshu.com/u/a723bf5483d7" rel="noopener" target="_blank"><i class="fa fa-fw fa-heartbeat"></i>简书</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/2879352237/profile?rightmod=1&wvr=6&mod=personinfo" title="Weibo &rarr; https://weibo.com/2879352237/profile?rightmod=1&wvr=6&mod=personinfo" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://music.163.com/#/user/home?id=321895687" title="CloudMusic &rarr; https://music.163.com/#/user/home?id=321895687" rel="noopener" target="_blank"><i class="fa fa-fw fa-music"></i>CloudMusic</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://shuinoo.github.io/" title="https://shuinoo.github.io/" rel="noopener" target="_blank">蔡shuishui</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://litten.me/" title="http://litten.me/" rel="noopener" target="_blank">litten</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://jysperm.me/" title="https://jysperm.me/" rel="noopener" target="_blank">Mr wang</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ephen.me/" title="https://ephen.me/" rel="noopener" target="_blank">Ephen</a>
                  </li>
                
              </ul>
            </div>
          
          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#linux上的系统监控命令：ps、uptime、top、sar、vmstat、iostat、dstat、iotop、lsof的使用"><span class="nav-number">1.</span> <span class="nav-text">linux上的系统监控命令：ps、uptime、top、sar、vmstat、iostat、dstat、iotop、lsof的使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ps命令：process-state"><span class="nav-number">2.</span> <span class="nav-text">ps命令：process state</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iftop"><span class="nav-number">3.</span> <span class="nav-text">iftop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#uptime命令"><span class="nav-number">4.</span> <span class="nav-text">uptime命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进程管理工具–-gt-top命令"><span class="nav-number">5.</span> <span class="nav-text">进程管理工具–&gt;top命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sar"><span class="nav-number">6.</span> <span class="nav-text">sar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内存管理工具之–-gt-vmstat-虚拟内存信息"><span class="nav-number">7.</span> <span class="nav-text">内存管理工具之–&gt;vmstat:虚拟内存信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#内存管理工具之–-gt-iostat-统计CPU和设备IO信息"><span class="nav-number">8.</span> <span class="nav-text">内存管理工具之–&gt;iostat:统计CPU和设备IO信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统监控工具–-gt-dstat命令：系统资源统计-代替vmstat-iostat-ifstat"><span class="nav-number">9.</span> <span class="nav-text">系统监控工具–&gt;dstat命令：系统资源统计,代替vmstat,iostat,ifstat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#监视磁盘I-O工具–-gt-iotop"><span class="nav-number">10.</span> <span class="nav-text">监视磁盘I/O工具–&gt;iotop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lsof-list-open-files"><span class="nav-number">11.</span> <span class="nav-text">lsof:list open files</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

      <div style="">
  <canvas id="canvas" style="width:70%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">空腹吃早餐</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">1.4m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">20:48</span>
  
</div>









<!-- 网站运行时间的设置 -->
<center>
    <font size="3" color="#FF0000">Coool's Blog已运行:<span id="run_time" style="color:#DB70DB"></span></font>  Sometimes your whole life boils down to one insame move.
</center>

<script>
    function runTime() {
        var d = new Date(),str = '';
        BirthDay=new Date("Nov 18,2017");
        today=new Date();
        timeold=(today.getTime()-BirthDay.getTime());
        sectimeold=timeold/1000
        secondsold=Math.floor(sectimeold);
        msPerDay=24*60*60*1000
        e_daysold=timeold/msPerDay
        daysold=Math.floor(e_daysold);
        str = ""+daysold+"天";
        str += d.getHours()+'时'; 
        str  += d.getMinutes()+'分'; 
        str+= d.getSeconds()+'秒'; 
        return str;
    }
    setInterval(function(){$('#run_time').html(runTime())},1000);
</script>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
      
  
  <script type="text/javascript" color="255,0,0" opacity="1" zindex="-1" count="230" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.6.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.6.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="/js/src/Valine.min.js"></script>

  <!-- https://deserts.io/diy-a-comment-system/ -->
  <script type="text/javascript">
    new Valine({
        lang: 'zh-cn',
        admin_email: '645150765@qq.com', //博主邮箱
        el: '#comments' ,
        appId: 'vk3KaAky0698trITaDye8Tul-gzGzoHsz',
        appKey: '3KISEUBblfzGHUAGvFxJvEyo',
        emoticon_url: 'https://cloud.panjunwen.com/alu',
        emoticon_list: ["吐.png","喷血.png","狂汗.png","不说话.png","汗.png","坐等.png","献花.png","不高兴.png","中刀.png","害羞.png","皱眉.png","小眼睛.png","中指.png","尴尬.png","瞅你.png","想一想.png","中枪.png","得意.png","肿包.png","扇耳光.png","亲亲.png","惊喜.png","脸红.png","无所谓.png","便便.png","愤怒.png","蜡烛.png","献黄瓜.png","内伤.png","投降.png","观察.png","看不见.png","击掌.png","抠鼻.png","邪恶.png","看热闹.png","口水.png","抽烟.png","锁眉.png","装大款.png","吐舌.png","无奈.png","长草.png","赞一个.png","呲牙.png","无语.png","阴暗.png","不出所料.png","咽气.png","期待.png","高兴.png","吐血倒地.png","哭泣.png","欢呼.png","黑线.png","喜极而泣.png","喷水.png","深思.png","鼓掌.png","暗地观察.png"],
        placeholder: '帅的人已经评论',
  });

  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      
        // ref: https://github.com/ForbesLindesay/unescape-html
        var unescapeHtml = function(html) {
          return String(html)
            .replace(/&quot;/g, '"')
            .replace(/&#39;/g, '\'')
            .replace(/&#x3A;/g, ':')
            // replace all the other &#x; chars
            .replace(/&#(\d+);/g, function (m, p) { return String.fromCharCode(p); })
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&amp;/g, '&');
        };
      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                content = unescapeHtml(content);
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>